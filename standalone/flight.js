(function(context){var factories={},loaded={};var isArray=Array.isArray||function(obj){return obj.constructor==Array};var map=Array.map||function(arr,fn,scope){for(var i=0,len=arr.length,result=[];i<len;i++){result.push(fn.call(scope,arr[i]))}return result};function define(){var args=Array.prototype.slice.call(arguments),dependencies=[],id,factory;if(typeof args[0]=="string"){id=args.shift()}if(isArray(args[0])){dependencies=args.shift()}factory=args.shift();factories[id]=[dependencies,factory]}function require(id){function resolve(dep){var relativeParts=id.split("/"),depParts=dep.split("/"),relative=false;relativeParts.pop();while(depParts[0]==".."&&relativeParts.length){relativeParts.pop();depParts.shift();relative=true}if(depParts[0]=="."){depParts.shift();relative=true}if(relative){depParts=relativeParts.concat(depParts)}return depParts.join("/")}var unresolved,factory,dependencies;if(typeof loaded[id]=="undefined"){unresolved=factories[id];if(unresolved){dependencies=unresolved[0];factory=unresolved[1];loaded[id]=factory.apply(undefined,map(dependencies,function(id){return require(resolve(id))}))}}return loaded[id]};define("lib/utils",[],function(){var a=[],b=100,c={isDomObj:function(a){return!!a.nodeType||a===window},toArray:function(b,c){return a.slice.call(b,c)},merge:function(){var a=this.toArray(arguments);return a.unshift({}),a[a.length-1]===!0&&(a.pop(),a.unshift(!0)),$.extend.apply(undefined,a)},push:function(a,b,c){return a&&Object.keys(b||{}).forEach(function(d){if(a[d]&&c)throw Error("utils.push attempted to overwrite '"+d+"' while running in protected mode");typeof a[d]=="object"&&typeof b[d]=="object"?this.push(a[d],b[d]):a[d]=b[d]},this),a},isEnumerable:function(a,b){return Object.keys(a).indexOf(b)>-1},compose:function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},uniqueArray:function(a){var b={},c=[];for(var d=0,e=a.length;d<e;++d){if(b.hasOwnProperty(a[d]))continue;c.push(a[d]),b[a[d]]=1}return c},debounce:function(a,c,d){typeof c!="number"&&(c=b);var e,f;return function(){var b=this,g=arguments,h=function(){e=null,d||(f=a.apply(b,g))},i=d&&!e;return clearTimeout(e),e=setTimeout(h,c),i&&(f=a.apply(b,g)),f}},throttle:function(a,c){typeof c!="number"&&(c=b);var d,e,f,g,h,i,j=this.debounce(function(){h=g=!1},c);return function(){d=this,e=arguments;var b=function(){f=null,h&&(i=a.apply(d,e)),j()};return f||(f=setTimeout(b,c)),g?h=!0:(g=!0,i=a.apply(d,e)),j(),i}},countThen:function(a,b){return function(){if(!--a)return b.apply(this,arguments)}},delegate:function(a){return function(b,c){var d=$(b.target),e;Object.keys(a).forEach(function(f){if((e=d.closest(f)).length)return c=c||{},c.el=e[0],a[f].apply(this,[b,c])},this)}}};return c})
define("lib/registry",["./utils"],function(a){function b(b,c){var d,e,f;return c=a.toArray(c),typeof c[c.length-1]=="function"&&(f=c.pop()),typeof c[c.length-1]=="object"&&c.pop(),c.length==2?(d=c[0],e=c[1]):(d=b.node,e=c[0]),{element:d,type:e,callback:f}}function c(a,b){return a.element==b.element&&a.type==b.type&&(b.callback==null||a.callback==b.callback)}function d(){function e(a){this.component=a,this.instances=[],this.addInstance=function(a){this.throwIfInstanceExistsOnNode(a);var b=new f(a);return this.instances.push(b),b},this.throwIfInstanceExistsOnNode=function(a){this.instances.forEach(function(b){if(b.instance.$node[0]===a.$node[0])throw new Error("Instance of "+a.constructor+" already exists on node "+a.$node[0])})},this.removeInstance=function(a){var b=this.instances.filter(function(b){return b.instance==a})[0],c=this.instances.indexOf(b);c>-1&&this.instances.splice(c,1),this.instances.length||d.removeComponentInfo(this)}}function f(a){this.instance=a,this.events=[],this.addTrigger=function(){},this.addBind=function(a){this.events.push(a),d.events.push(a)},this.removeBind=function(a){for(var b=0,d;d=this.events[b];b++)c(d,a)&&this.events.splice(b,1)}}var d=this;(this.reset=function(){this.components=[],this.allInstances=[],this.events=[]}).call(this),this.addInstance=function(a){var b=this.findComponentInfo(a);b||(b=new e(a.constructor),this.components.push(b));var c=b.addInstance(a);return this.allInstances.push(c),b},this.removeInstance=function(a){var b,c=this.findInstanceInfo(a),d=this.findComponentInfo(a);d.removeInstance(a);var b=this.allInstances.indexOf(c);b>-1&&this.allInstances.splice(b,1)},this.removeComponentInfo=function(a){var b=this.components.indexOf(a);b>-1&&this.components.splice(b,1)},this.findComponentInfo=function(a){var b=a.attachTo?a:a.constructor;for(var c=0,d;d=this.components[c];c++)if(d.component===b)return d;return null},this.findInstanceInfo=function(a){var b;a.node?b=function(b){return b.instance===a}:b=function(b){return b.instance.node===a};var c=this.allInstances.filter(b);return c.length?a.node?c[0]:c:a.node?null:[]},this.trigger=function(){var a=b(this,arguments),c=d.findInstanceInfo(this);c&&c.addTrigger(a)},this.on=function(c){var e=a.toArray(arguments,1),f=d.findInstanceInfo(this),g;if(f){g=c.apply(null,e),g&&(e[e.length-1]=g);var h=b(this,e);f.addBind(h)}},this.off=function(a,c,e){var f=b(this,arguments),g=d.findInstanceInfo(this);g&&g.removeBind(f)},this.teardown=function(){d.removeInstance(this)},this.withRegistration=function(){this.before("initialize",function(){d.addInstance(this)}),this.after("trigger",d.trigger),this.around("on",d.on),this.after("off",d.off),this.after("teardown",{obj:d,fnName:"teardown"})}}return new d})
define("tools/debug/debug",["../../lib/registry","../../lib/utils"],function(a,b){function d(a,b,c){var c=c||{},e=c.obj||window,g=c.path||(e==window?"window":""),h=Object.keys(e);h.forEach(function(c){(f[a]||a)(b,e,c)&&console.log([g,".",c].join(""),"->",["(",typeof e[c],")"].join(""),e[c]),Object.prototype.toString.call(e[c])=="[object Object]"&&e[c]!=e&&g.split(".").indexOf(c)==-1&&d(a,b,{obj:e[c],path:[g,c].join(".")})})}function e(a,b,c,e){!b||typeof c==b?d(a,c,e):console.error([c,"must be",b].join(" "))}function g(a,b){e("name","string",a,b)}function h(a,b){e("nameContains","string",a,b)}function i(a,b){e("type","function",a,b)}function j(a,b){e("value",null,a,b)}function k(a,b){e("valueCoerced",null,a,b)}function l(a,b){d(a,null,b)}function n(){var a=[].slice.call(arguments,0);c.eventNames.length||(c.eventNames="all"),c.actions=a.length?a:"all"}function o(){var a=[].slice.call(arguments,0);c.actions.length||(c.actions="all"),c.eventNames=a.length?a:"all"}function p(){c.actions=[],c.eventNames=[]}function q(){c.actions="all",c.eventNames="all"}var c,f={name:function(a,b,c){return a==c},nameContains:function(a,b,c){return c.indexOf(a)>-1},type:function(a,b,c){return b[c]instanceof a},value:function(a,b,c){return b[c]===a},valueCoerced:function(a,b,c){return b[c]==a}},m="all";return c={actions:m,eventNames:m},{enable:function(a){this.enabled=!!a,a&&window.console&&(console.info("Booting in DEBUG mode"),console.info("You can filter event logging with DEBUG.events.logAll/logNone/logByName/logByAction")),window.DEBUG=this},find:{byName:g,byNameContains:h,byType:i,byValue:j,byValueCoerced:k,custom:l},events:{logFilter:c,logByAction:n,logByName:o,logAll:q,logNone:p}}})
define("lib/compose",["./utils","../tools/debug/debug"],function(a,b){function f(a,b){if(!c)return;var e=Object.create(null);Object.keys(a).forEach(function(c){if(d.indexOf(c)<0){var f=Object.getOwnPropertyDescriptor(a,c);f.writable=b,e[c]=f}}),Object.defineProperties(a,e)}function g(a,b,d){var e;if(!c||!a.hasOwnProperty(b)){d.call(a);return}e=Object.getOwnPropertyDescriptor(a,b).writable,Object.defineProperty(a,b,{writable:!0}),d.call(a),Object.defineProperty(a,b,{writable:e})}function h(a,b){a.mixedIn=a.hasOwnProperty("mixedIn")?a.mixedIn:[],b.forEach(function(b){a.mixedIn.indexOf(b)==-1&&(f(a,!1),b.call(a),a.mixedIn.push(b))}),f(a,!0)}var c=b.enabled&&!a.isEnumerable(Object,"getOwnPropertyDescriptor"),d=["mixedIn"];if(c)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(e){c=!1}return{mixin:h,unlockProperty:g}})
define("lib/advice",["./utils","./compose"],function(a,b){var c={around:function(b,c){return function(){var d=a.toArray(arguments);return c.apply(this,[b.bind(this)].concat(d))}},before:function(b,c){return this.around(b,function(){var b=a.toArray(arguments),d=b.shift(),e;return e=typeof c=="function"?c:c.obj[c.fnName],e.apply(this,b),d.apply(this,b)})},after:function(b,c){return this.around(b,function(){var b=a.toArray(arguments),d=b.shift(),e,f=(d.unbound||d).apply(this,b);return e=typeof c=="function"?c:c.obj[c.fnName],e.apply(this,b),f})},withAdvice:function(){["before","after","around"].forEach(function(a){this[a]=function(d,e){b.unlockProperty(this,d,function(){return typeof this[d]=="function"?this[d]=c[a](this[d],e):this[d]=e})}},this)}};return c})
define("lib/component",["./advice","./utils","./compose","./registry"],function(a,b,c,d){function e(a){a.events.slice().forEach(function(a){var b=[a.type];a.element&&b.unshift(a.element),typeof a.callback=="function"&&b.push(a.callback),this.off.apply(this,b)},a.instance)}function f(){this.trigger("componentTearDown"),e(d.findInstanceInfo(this))}function g(){var a=d.findComponentInfo(this);a&&a.instances.slice().forEach(function(a){a.instance.teardown()})}function h(){this.trigger=function(){var a,c,d,e=b.toArray(arguments);typeof e[e.length-1]!="string"&&(d=e.pop()),a=e.length==2?$(e.shift()):this.$node,c=e[0];if(window.DEBUG&&window.postMessage)try{window.postMessage(d,"*")}catch(f){throw console.log("unserializable data for event",c,":",d),new Error(["The event",event.type,"on component",this.describe,"was triggered with non-serializable data"].join(" "))}return typeof this.attr.eventData=="object"&&(d=$.extend(!0,{},this.attr.eventData,d)),a.trigger(c,d)},this.on=function(){var a,c,d,e,f=b.toArray(arguments);typeof f[f.length-1]=="object"?e=b.delegate(this.resolveDelegateRules(f.pop())):e=f.pop(),d=e&&e.bind(this),d.target=e,a=f.length==2?$(f.shift()):this.$node,c=f[0];if(typeof d=="undefined")throw new Error("Unable to bind to '"+c+"' because the given callback is undefined");return a.on(c,d),e.guid=d.guid,d},this.off=function(){var a,c,d,e=b.toArray(arguments);return typeof e[e.length-1]=="function"&&(d=e.pop()),a=e.length==2?$(e.shift()):this.$node,c=e[0],a.off(c,d)},this.resolveDelegateRules=function(a){var b={};return Object.keys(a).forEach(function(c){if(!this.attr.hasOwnProperty(c))throw new Error('Component "'+this.describe+'" wants to listen on "'+c+'" but no such attribute was defined.');b[this.attr[c]]=a[c]},this),b},this.defaultAttrs=function(a){b.push(this.defaults,a,!0)||(this.defaults=a)},this.select=function(a){return this.$node.find(this.attr[a])},this.initialize=$.noop,this.teardown=f}function i(a){if(!a)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");var c=b.merge.apply(b,b.toArray(arguments,1));$(a).each(function(a,b){new this(b,c)}.bind(this))}function j(){function f(a,c){var d={},e=0;if(!a)throw new Error("Component needs a node");a.jquery?(this.node=a[0],this.$node=a):(this.node=a,this.$node=$(a)),this.describe=this.constructor.describe,this.bind=function(a){var c;if(a.uuid&&(c=d[a.uuid]))return c;var f=b.toArray(arguments,1);return f.unshift(this),c=a.bind.apply(a,f),c.target=a,a.uuid=e++,d[a.uuid]=c,c},this.attr=b.merge(this.defaults,c),this.defaults&&Object.keys(this.defaults).forEach(function(a){if(this.defaults[a]===null&&this.attr[a]===null)throw new Error('Required attribute "'+a+'" not specified in attachTo for component "'+this.describe+'".')},this),this.initialize.call(this,c||{}),this.trigger("componentInitialized")}var e=b.toArray(arguments);return f.toString=function(){var a=e.map(function(a){if($.browser.msie){var b=a.toString().match(/function (.*?)\s?\(/);return b&&b[1]?b[1]:""}return a.name}).join(", ").replace(/\s\,/g,"");return a},f.describe=f.toString(),f.attachTo=i,f.teardownAll=g,e.unshift(h,a.withAdvice,d.withRegistration),c.mixin(f.prototype,e),f}return j.teardownAll=function(){d.components.slice().forEach(function(a){a.component.teardownAll()}),d.reset()},j})
define("lib/logger",["./compose","./utils"],function(a,b){function d(a){var b=a.tagName?a.tagName.toLowerCase():a.toString(),c=a.className?"."+a.className:"",d=b+c;return a.tagName?["'","'"].join(d):d}function e(a,b,e){var f,g,h,i,j,k,l,m;typeof e[e.length-1]=="function"&&(h=e.pop(),h=h.unbound||h),typeof e[e.length-1]=="object"&&e.pop(),e.length==2?(g=e[0],f=e[1]):(g=b.$node[0],f=e[0]),window.DEBUG&&(j=DEBUG.events.logFilter,l=j.actions=="all"||j.actions.indexOf(a)>-1,k=function(a){return a.test?a:new RegExp("^"+a.replace(/\*/g,".*")+"$")},m=j.eventNames=="all"||j.eventNames.some(function(a){return k(a).test(f)}),l&&m&&console.info(c[a],a,"["+f+"]",d(g),b.constructor.describe,h&&(i=h.name||h.displayName)&&"->  "+i))}function f(){this.before("trigger",function(){e("trigger",this,b.toArray(arguments))}),this.before("on",function(){e("on",this,b.toArray(arguments))}),this.before("off",function(a){e("off",this,b.toArray(arguments))})}var c={on:"<-",trigger:"->",off:"x "};return f})
define("lib/index",["./advice","./component","./compose","./logger","./registry","./utils"],function(a,b,c,d,e,f){return{advice:a,component:b,compose:c,logger:d,registry:e,utils:f}});context.flight=require("lib/index")})(this);